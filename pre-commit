#!/usr/bin/env bash
set -euo pipefail

# Prevent infinite recursion when this repo uses its own hooks
if [ "${_COMMITHOOKS_GUARD:-}" = "1" ]; then
  exit 0
fi
export _COMMITHOOKS_GUARD=1

repo_root="$(git rev-parse --show-toplevel || true)"
if [ -z "$repo_root" ]; then
  echo "Unable to determine repository root." >&2
  exit 1
fi

local_hook_candidates=(
  "$repo_root/.githooks/pre-commit"
  "$repo_root/scripts/git-hooks/pre-commit"
)

for hook in "${local_hook_candidates[@]}"; do
  if [ -x "$hook" ]; then
    exec "$hook" "$@"
  fi
done

if [ "${COMMITHOOKS_SKIP_NOOP:-0}" = "1" ]; then
  exit 0
fi

echo "[pre-commit] No local hook implementation found in:"
echo "           $repo_root/.githooks/pre-commit"
echo "           $repo_root/scripts/git-hooks/pre-commit"
echo "Applying shared no-op baseline."
exit 0
